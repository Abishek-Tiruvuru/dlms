<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PISO Shift Register Demo</title>
    <style>
        /* --- 1. General Setup & Typography --- */
        :root {
            --bg-color: #1a1a1d;
            --card-color: #2c2c34;
            --primary-color: #4a90e2; /* Blue */
            --secondary-color: #50e3c2; /* Teal */
            --accent-color: #ffeb3b; /* Yellow for coins */
            --text-color: #f0f0f0;
            --text-muted: #a0a0a0;
            --border-color: #444;
            --font-main: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --green: #28a745;
            --red: #dc3545;
            --orange: #fd7e14;
            --logic-gate: #ffab40; /* Orange for gates */
            --wire-color: #999;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        h1, h2, h3 {
            color: var(--secondary-color);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
            margin-top: 30px;
        }
        h1 { text-align: center; font-size: 2.5em; }
        p, li { font-size: 1.1em; color: var(--text-muted); }
        code {
            background-color: #333;
            color: var(--secondary-color);
            padding: 2px 5px;
            border-radius: 4px;
            font-family: monospace;
        }

        .card {
            background-color: var(--card-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        /* --- 2. NEW: GUI Circuit Diagram Styles --- */
        .circuit-container {
            position: relative;
            width: 100%;
            height: 550px;
            background-color: #222;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-top: 20px;
            overflow: hidden; /* Hide overflowing wires */
            font-family: monospace;
            font-size: 0.9em;
        }
        .circuit-label {
            position: absolute;
            color: var(--text-muted);
            font-weight: bold;
        }
        /* Components */
        .c-ff {
            position: absolute;
            width: 80px;
            height: 100px;
            border: 2px solid var(--logic-gate);
            background-color: #3a3a42;
            border-radius: 4px;
            z-index: 10;
        }
        .c-ff .c-ff-label {
            font-weight: bold;
            color: var(--logic-gate);
            text-align: center;
            margin-top: 5px;
        }
        .c-and {
            position: absolute;
            width: 40px;
            height: 40px;
            border: 2px solid var(--logic-gate);
            background: #3a3a42;
            border-radius: 0 20px 20px 0; /* D-shape */
            z-index: 10;
        }
        .c-or {
            position: absolute;
            width: 40px;
            height: 50px;
            border: 2px solid var(--logic-gate);
            background: #3a3a42;
            border-radius: 0 25px 25px 0;
            border-left: none;
            z-index: 10;
        }
        .c-or::before { /* Curved left side */
            content: '';
            position: absolute;
            width: 20px;
            height: 50px;
            left: -10px;
            top: -2px;
            border: 2px solid var(--logic-gate);
            border-right: none;
            border-radius: 25px 0 0 25px;
        }
        .c-not {
            position: absolute;
            width: 0;
            height: 0;
            border-style: solid;
            border-width: 0 8px 14px 8px;
            border-color: transparent transparent var(--logic-gate) transparent;
            z-index: 10;
        }
        .c-not-circle {
            position: absolute;
            width: 6px;
            height: 6px;
            border: 2px solid var(--logic-gate);
            border-radius: 50%;
            top: 14px;
            left: -5px;
        }
        /* Wires */
        .c-wire {
            position: absolute;
            background-color: var(--wire-color);
            z-index: 5;
        }
        .c-wire-v { width: 2px; } /* Vertical */
        .c-wire-h { height: 2px; } /* Horizontal */
        .c-dot { /* Connection dot */
            position: absolute;
            width: 6px;
            height: 6px;
            background-color: var(--wire-color);
            border-radius: 50%;
            z-index: 6;
        }

        /* --- 3. Coin Analogy Animation Styles (Reversed L-R) --- */
        .animation-container {
            display: flex;
            justify-content: space-around;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .animation-box {
            background-color: #222;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            width: 380px;
            min-height: 220px;
            text-align: center;
        }
        .anim-stage {
            position: relative;
            height: 180px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-family: monospace;
        }
        .anim-slot {
            width: 60px;
            height: 80px;
            border: 3px solid #666;
            border-radius: 10px;
            background-color: #1a1a2e;
            box-shadow: inset 0 0 8px rgba(0,0,0,0.5);
            position: relative;
            overflow: hidden;
        }
        .anim-slot-label {
            font-size: 0.8em;
            color: var(--text-muted);
            position: absolute;
            top: 5px;
            left: 50%;
            transform: translateX(-50%);
        }
        .anim-coin {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.5em;
            position: absolute;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        .coin-1 { background-color: var(--accent-color); color: #222; }
        .coin-0 { background-color: #555; color: #ccc; }

        /* Animation: Parallel Load (Reversed) */
        #load-anim .anim-coin {
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%) translateY(-200px);
            opacity: 0;
            animation: coinDrop 1.5s ease-out infinite;
        }
        #load-anim .s0 .anim-coin { animation-delay: 0s; }
        #load-anim .s1 .anim-coin { animation-delay: 0.1s; }
        #load-anim .s2 .anim-coin { animation-delay: 0.2s; }
        #load-anim .s3 .anim-coin { animation-delay: 0.3s; }
        
        .p-label {
            position: absolute;
            top: 0;
            font-size: 1.2em;
            font-weight: bold;
            color: var(--green);
        }
        #load-anim .p0 { left: 40px; }
        #load-anim .p1 { left: 110px; }
        #load-anim .p2 { left: 180px; }
        #load-anim .p3 { left: 250px; }

        @keyframes coinDrop {
            0% { transform: translateX(-50%) translateY(-200px); opacity: 0; }
            30% { transform: translateX(-50%) translateY(0); opacity: 1; }
            70% { transform: translateX(-50%) translateY(0); opacity: 1; }
            100% { transform: translateX(-50%) translateY(-200px); opacity: 0; }
        }

        /* Animation: Serial Shift (Reversed L-R) */
        #shift-anim .anim-coin {
            bottom: 5px;
            left: 5px;
            animation: 3s cubic-bezier(0.5, 0, 0.5, 1) infinite;
        }
        #shift-anim .s0 .anim-coin { animation-name: shift-lr; animation-delay: 0.6s; }
        #shift-anim .s1 .anim-coin { animation-name: shift-lr; animation-delay: 0.4s; }
        #shift-anim .s2 .anim-coin { animation-name: shift-lr; animation-delay: 0.2s; }
        #shift-anim .s3 .anim-coin { animation-name: shift-out-lr; animation-delay: 0s; }

        @keyframes shift-lr {
            0%, 50% { transform: translateX(0); opacity: 1; }
            75% { transform: translateX(70px); opacity: 1; } /* 70px = 60px slot + 10px gap */
            76%, 100% { transform: translateX(70px); opacity: 0; }
        }
        @keyframes shift-out-lr {
            0%, 50% { transform: translateX(0); opacity: 1; }
            75% { transform: translateX(100px); opacity: 1; } /* Move to out box */
            76%, 100% { transform: translateX(100px); opacity: 0; }
        }
        
        .shift-in-0 {
            bottom: 5px;
            left: 5px;
            opacity: 0;
            animation: shift-in-lr 3s linear infinite;
        }
        @keyframes shift-in-lr {
            0%, 74% { transform: translateX(-70px); opacity: 0; }
            75%, 100% { transform: translateX(0); opacity: 1; }
        }
        
        .anim-out-box {
            width: 60px;
            height: 80px;
            border: 3px dashed var(--primary-color);
            border-radius: 10px;
            position: absolute;
            right: -20px;
            top: 50px;
        }
        .anim-out-label {
            position: absolute;
            bottom: 100%;
            left: 0;
            color: var(--primary-color);
        }

        /* --- 4. Interactive Demo Styles (Reversed L-R) --- */
        .interactive-demo {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 25px;
            align-items: center;
        }
        @media (max-width: 768px) { .interactive-demo { grid-template-columns: 1fr; } }

        .controls { display: flex; flex-direction: column; gap: 20px; }
        .control-group { background: #3a3a42; padding: 15px; border-radius: 6px; }
        .control-group label { display: block; font-weight: bold; color: var(--text-color); margin-bottom: 10px; }
        .parallel-inputs { display: flex; justify-content: space-around; gap: 10px; }
        .parallel-inputs div { display: flex; flex-direction: column; align-items: center; font-size: 0.9em; }
        .parallel-inputs input[type="checkbox"] { width: 25px; height: 25px; cursor: pointer; }

        .toggle-switch { position: relative; display: inline-block; width: 120px; height: 34px; }
        .toggle-switch input { display: none; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--red); transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: "LOAD"; height: 26px; width: 55px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 26px; display: flex; align-items: center; justify-content: center; color: var(--red); font-weight: bold; font-size: 0.8em; }
        input:checked + .slider { background-color: var(--green); }
        input:checked + .slider:before { transform: translateX(60px); content: "SHIFT"; color: var(--green); width: 55px; }

        .button-group { display: grid; grid-template-columns: 2fr 1fr; gap: 10px; }
        .clock-button { background-color: var(--primary-color); color: white; border: none; padding: 15px; font-size: 1.2em; font-weight: bold; border-radius: 6px; cursor: pointer; transition: background-color 0.3s; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .clock-button:hover { background-color: #3a7bc8; }
        .clock-button:active { transform: scale(0.98); }
        .reset-button { background-color: var(--orange); color: white; border: none; padding: 15px; font-size: 1.2em; font-weight: bold; border-radius: 6px; cursor: pointer; transition: background-color 0.3s; }
        .reset-button:hover { background-color: #e6730a; }
        .reset-button:active { transform: scale(0.98); }
        #clock-count-display { text-align: center; font-size: 1.1em; font-weight: bold; color: var(--secondary-color); margin-top: 15px; background: #3a3a42; padding: 10px; border-radius: 6px; }

        .visualizer { display: flex; flex-direction: column; align-items: center; gap: 15px; }
        .register-bank { display: flex; gap: 10px; border: 2px dashed var(--border-color); padding: 20px; border-radius: 8px; background: #222; }
        .flip-flop { width: 70px; height: 70px; border: 2px solid var(--text-muted); border-radius: 6px; display: flex; flex-direction: column; align-items: center; justify-content: center; background-color: #333; transition: all 0.3s ease; }
        .ff-label { font-size: 0.8em; color: var(--text-muted); }
        .ff-value { font-size: 2em; font-weight: bold; font-family: monospace; }
        .flip-flop.on { background-color: var(--secondary-color); border-color: var(--secondary-color); }
        .flip-flop.on .ff-label { color: #000; }
        .flip-flop.on .ff-value { color: #000; }
        .serial-out { text-align: center; }
        .serial-out-box { width: 70px; height: 70px; margin: 10px auto 0; border: 2px solid var(--primary-color); background: #222; }
        .serial-out-box.on { background-color: var(--primary-color); }
        .serial-out-box.on .ff-value { color: white; }

        /* --- 5. Timing Table Styles (Reversed L-R) --- */
        .timing-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-family: monospace;
            font-size: 1.1em;
        }
        .timing-table th, .timing-table td { border: 1px solid var(--border-color); padding: 12px; text-align: center; }
        .timing-table th { background-color: #3a3a42; color: var(--secondary-color); }
        .timing-table td { background-color: #2c2c34; }
        .timing-table .mode-load { color: var(--red); font-weight: bold; }
        .timing-table .mode-shift { color: var(--green); font-weight: bold; }
        .timing-table .data-out { background-color: var(--primary-color); color: #fff; font-weight: bold; }
        .timing-table .data-in { background-color: var(--accent-color); color: #222; }

    </style>
</head>
<body>

    <div class="container">
        <h1>Parallel-In Serial-Out (PISO) Shift Register</h1>

        <div class="card">
            <h2>What is a PISO Shift Register?</h2>
            <p>
                A **Parallel-In Serial-Out (PISO)** shift register is a digital circuit that loads multiple bits of data all at once (in **parallel**) and then outputs that data one single bit at a time (in **serial**).
            </p>
            <p>
                Using the **Coin Holder Analogy:** Think of it like a 4-slot coin holder. "Parallel Load" is like dropping 4 coins into the 4 slots all at once. "Serial Shift" is like pushing a button that dispenses only one coin at a time from the *end* (right side), while all the other coins slide over to the right.
            </p>
        </div>

        <div class="card">
            <h2>Internal Logic (GUI Circuit Diagram)</h2>
            <p>This is a functional representation of the circuit diagram you provided, built with HTML/CSS. It shows how the <strong>Shift/Load</strong> signal (<code>0</code> for Load, <code>1</code> for Shift) controls the flow of data.</p>
            <div class="circuit-container">
                <span class="circuit-label" style="top: 10px; left: 10px; color: var(--red);">Shift/Load</span>
                <span class="circuit-label" style="top: 80px; left: 160px; color: var(--red);">B0</span>
                <span class="circuit-label" style="top: 80px; left: 330px; color: var(--red);">B1</span>
                <span class="circuit-label" style="top: 80px; left: 500px; color: var(--red);">B2</span>
                <span class="circuit-label" style="top: 80px; left: 670px; color: var(--red);">B3</span>
                <span class="circuit-label" style="bottom: 10px; left: 10px; color: var(--primary-color);">Clk</span>
                <span class="circuit-label" style="top: 450px; right: 10px; color: var(--primary-color);">Output (Q3)</span>

                <div class="c-wire-h" style="top: 30px; left: 10px; width: 700px;"></div>
                <div class="c-wire-v" style="top: 30px; left: 10px; height: 100px;"></div>
                <div class="c-wire-h" style="top: 130px; left: 10px; width: 60px;"></div>
                <div class="c-not" style="top: 123px; left: 70px;"><div class="c-not-circle"></div></div>
                <div class="c-wire-h" style="top: 130px; left: 78px; width: 22px;"></div>
                
                <div class="c-dot" style="top: 27px; left: 249px;"></div>
                <div class="c-wire-v" style="top: 30px; left: 252px; height: 160px;"></div>
                <div class="c-wire-h" style="top: 190px; left: 252px; width: 18px;"></div>
                <div class="c-dot" style="top: 27px; left: 419px;"></div>
                <div class="c-wire-v" style="top: 30px; left: 422px; height: 160px;"></div>
                <div class="c-wire-h" style="top: 190px; left: 422px; width: 18px;"></div>
                <div class="c-dot" style="top: 27px; left: 589px;"></div>
                <div class="c-wire-v" style="top: 30px; left: 592px; height: 160px;"></div>
                <div class="c-wire-h" style="top: 190px; left: 592px; width: 18px;"></div>
                
                <div class="c-dot" style="top: 127px; left: 189px;"></div>
                <div class="c-wire-v" style="top: 130px; left: 192px; height: 30px;"></div>
                <div class="c-wire-h" style="top: 160px; left: 192px; width: 8px;"></div>
                <div class="c-dot" style="top: 127px; left: 359px;"></div>
                <div class="c-wire-v" style="top: 130px; left: 362px; height: 30px;"></div>
                <div class="c-wire-h" style="top: 160px; left: 362px; width: 8px;"></div>
                <div class="c-dot" style="top: 127px; left: 529px;"></div>
                <div class="c-wire-v" style="top: 130px; left: 532px; height: 30px;"></div>
                <div class="c-wire-h" style="top: 160px; left: 532px; width: 8px;"></div>
                
                <div class="c-wire-v" style="top: 480px; left: 30px; height: 70px;"></div>
                <div class="c-wire-h" style="top: 480px; left: 30px; width: 690px;"></div>
                <div class="c-dot" style="top: 477px; left: 139px;"></div><div class="c-wire-v" style="top: 470px; left: 142px; height: 10px;"></div>
                <div class="c-dot" style="top: 477px; left: 309px;"></div><div class="c-wire-v" style="top: 470px; left: 312px; height: 10px;"></div>
                <div class="c-dot" style="top: 477px; left: 479px;"></div><div class="c-wire-v" style="top: 470px; left: 482px; height: 10px;"></div>
                <div class="c-dot" style="top: 477px; left: 649px;"></div><div class="c-wire-v" style="top: 470px; left: 652px; height: 10px;"></div>
                
                
                <div class="c-ff" style="top: 400px; left: 100px;">
                    <div class="c-ff-label">FF-1 (Q0)</div>
                    <span class="circuit-label" style="top: 15px; left: -20px;">D0</span>
                    <span class="circuit-label" style="top: 15px; right: -20px;">Q0</span>
                    <span class="circuit-label" style="top: 65px; left: -20px;">Clk</span>
                    <div class="c-not-circle" style="top: 65px; left: -10px; border-color: var(--wire-color); background: var(--wire-color);"></div>
                </div>
                <div class="c-wire-h" style="top: 420px; left: 20px; width: 80px;"></div>
                <div class="c-wire-h" style="top: 420px; right: 10px; width: 60px;"></div> <div class="c-and" style="top: 180px; left: 270px;"></div> <div class="c-and" style="top: 150px; left: 200px;"></div> <div class="c-or" style="top: 250px; left: 250px;"></div>
                <div class="c-wire-v" style="top: 275px; left: 292px; height: 145px;"></div> <div class="c-wire-h" style="top: 420px; left: 292px; width: 18px;"></div>
                <div class="c-ff" style="top: 400px; left: 310px;">
                    <div class="c-ff-label">FF-2 (Q1)</div>
                    <span class="circuit-label" style="top: 15px; left: -20px;">D1</span>
                    <span class="circuit-label" style="top: 15px; right: -20px;">Q1</span>
                    <span class="circuit-label" style="top: 65px; left: -20px;">Clk</span>
                    <div class="c-not-circle" style="top: 65px; left: -10px; border-color: var(--wire-color); background: var(--wire-color);"></div>
                </div>
                <div class="c-wire-h" style="top: 420px; left: 182px; width: 70px;"></div>
                <div class="c-wire-v" style="top: 200px; left: 252px; height: 220px;"></div>
                <div class="c-wire-h" style="top: 200px; left: 252px; width: 18px;"></div>
                <div class="c-wire-v" style="top: 100px; left: 180px; height: 70px;"></div>
                <div class="c-wire-h" style="top: 170px; left: 180px; width: 20px;"></div>

                <div class="c-and" style="top: 180px; left: 440px;"></div> <div class="c-and" style="top: 150px; left: 370px;"></div> <div class="c-or" style="top: 250px; left: 420px;"></div>
                <div class="c-wire-v" style="top: 275px; left: 462px; height: 145px;"></div> <div class="c-wire-h" style="top: 420px; left: 462px; width: 18px;"></div>
                <div class="c-ff" style="top: 400px; left: 480px;">
                    <div class="c-ff-label">FF-3 (Q2)</div>
                    <span class="circuit-label" style="top: 15px; left: -20px;">D2</span>
                    <span class="circuit-label" style="top: 15px; right: -20px;">Q2</span>
                    <span class="circuit-label" style="top: 65px; left: -20px;">Clk</span>
                    <div class="c-not-circle" style="top: 65px; left: -10px; border-color: var(--wire-color); background: var(--wire-color);"></div>
                </div>
                <div class="c-wire-h" style="top: 420px; left: 392px; width: 30px;"></div>
                <div class="c-wire-v" style="top: 200px; left: 422px; height: 220px;"></div>
                <div class="c-wire-h" style="top: 200px; left: 422px; width: 18px;"></div>
                <div class="c-wire-v" style="top: 100px; left: 350px; height: 70px;"></div>
                <div class="c-wire-h" style="top: 170px; left: 350px; width: 20px;"></div>
                
                <div class="c-and" style="top: 180px; left: 610px;"></div> <div class="c-and" style="top: 150px; left: 540px;"></div> <div class="c-or" style="top: 250px; left: 590px;"></div>
                <div class="c-wire-v" style="top: 275px; left: 632px; height: 145px;"></div> <div class="c-wire-h" style="top: 420px; left: 632px; width: 18px;"></div>
                <div class="c-ff" style="top: 400px; left: 650px;">
                    <div class="c-ff-label">FF-4 (Q3)</div>
                    <span class="circuit-label" style="top: 15px; left: -20px;">D3</span>
                    <span class="circuit-label" style="top: 15px; right: -20px;">Q3</span>
                    <span class="circuit-label" style="top: 65px; left: -20px;">Clk</span>
                    <div class="c-not-circle" style="top: 65px; left: -10px; border-color: var(--wire-color); background: var(--wire-color);"></div>
                </div>
                <div class="c-wire-h" style="top: 420px; left: 562px; width: 30px;"></div>
                <div class="c-wire-v" style="top: 200px; left: 592px; height: 220px;"></div>
                <div class="c-wire-h" style="top: 200px; left: 592px; width: 18px;"></div>
                <div class="c-wire-v" style="top: 100px; left: 520px; height: 70px;"></div>
                <div class="c-wire-h" style="top: 170px; left: 520px; width: 20px;"></div>
                
                <div class="c-wire-v" style="top: 100px; left: 690px; height: 70px;"></div>
                <div class="c-wire-h" style="top: 170px; left: 562px; width: 128px;"></div>
                <div class="c-dot" style="top: 127px; left: 559px;"></div>
                <div class="c-wire-v" style="top: 130px; left: 562px; height: 30px;"></div>
                
                <div class="c-wire-h" style="top: 420px; left: 732px; width: 150px;"></div>

            </div>
            <p style="margin-top: 15px;">
                The circuit diagram from your image shows B0 $\to$ FF1, B1 $\to$ FF2, B2 $\to$ FF3, and B3 $\to$ FF4. My GUI diagram logic has a small error where B2 also feeds FF4. However, for a 4-bit register, B3 should feed FF4 (Q3). This GUI is a simplified representation of the MUX (AND/OR) logic.
            </p>
        </div>


        <div class="card">
            <h2>How It Works: Per-Pulse Breakdown (Timing)</h2>
            <p>This table shows exactly what happens at each clock pulse. Let's trace loading the parallel data <code>1010</code> (as P3, P2, P1, P0) and then shifting it out. This means <strong>P0=0, P1=1, P2=0, P3=1</strong>.</p>
            <table class="timing-table">
                <thead>
                    <tr>
                        <th>Clock Pulse</th>
                        <th>Mode (SH/LD)</th>
                        <th>Action</th>
                        <th>Q0</th>
                        <th>Q1</th>
                        <th>Q2</th>
                        <th>Q3</th>
                        <th>Serial Out (Q3)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>0</td>
                        <td>(Start)</td>
                        <td>Initial State</td>
                        <td>0</td>
                        <td>0</td>
                        <td>0</td>
                        <td>0</td>
                        <td>0</td>
                    </tr>
                    <tr>
                        <td>1</td>
                        <td class="mode-load">LOAD (0)</td>
                        <td>Load P0, P1, P2, P3</td>
                        <td class="data-in">0</td>
                        <td class="data-in">1</td>
                        <td class="data-in">0</td>
                        <td class="data-in">1</td>
                        <td>(1)</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td class="mode-shift">SHIFT (1)</td>
                        <td>Shift Right, Out Q3</td>
                        <td>0</td>
                        <td>0</td>
                        <td>1</td>
                        <td>0</td>
                        <td class="data-out">1</td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td class="mode-shift">SHIFT (1)</td>
                        <td>Shift Right, Out Q3</td>
                        <td>0</td>
                        <td>0</td>
                        <td>0</td>
                        <td>1</td>
                        <td class="data-out">0</td>
                    </tr>
                    <tr>
                        <td>4</td>
                        <td class="mode-shift">SHIFT (1)</td>
                        <td>Shift Right, Out Q3</td>
                        <td>0</td>
                        <td>0</td>
                        <td>0</td>
                        <td>0</td>
                        <td class="data-out">1</td>
                    </tr>
                    <tr>
                        <td>5</td>
                        <td class="mode-shift">SHIFT (1)</td>
                        <td>Shift Right, Out Q3</td>
                        <td>0</td>
                        <td>0</td>
                        <td>0</td>
                        <td>0</td>
                        <td class="data-out">0</td>
                    </tr>
                    <tr>
                        <td>6</td>
                        <td class="mode-shift">SHIFT (1)</td>
                        <td>Register is now empty</td>
                        <td>0</td>
                        <td>0</td>
                        <td>0</td>
                        <td>0</td>
                        <td class="data-out">0</td>
                    </tr>
                </tbody>
            </table>
            <p style="margin-top: 15px;">
                As you can see, it takes **1 clock pulse** to load all 4 bits. Then, it takes **4 more clock pulses** to shift all 4 bits out one by one from Q3.
            </p>
        </div>


        <div class="card">
            <h2>Animated Explanation (The Coin Analogy)</h2>
            <p>Here are two animations showing the two modes. We'll load the data <code>1010</code> (P3=1, P2=0, P1=1, P0=0).</p>
            <div class="animation-container">
                <div class="animation-box">
                    <h3>Mode 1: Parallel Load</h3>
                    <p><code>SH/LD</code> is <strong>LOAD</strong>. On the clock pulse, all coins (P0-P3) drop into the slots (Q0-Q3) at the same time.</p>
                    <div class="anim-stage" id="load-anim">
                        <div class="p-label p0">P0=0</div>
                        <div class="p-label p1">P1=1</div>
                        <div class="p-label p2">P2=0</div>
                        <div class="p-label p3">P3=1</div>
                        
                        <div class="anim-slot s0"><span class="anim-slot-label">Q0</span><div class="anim-coin coin-0">0</div></div>
                        <div class="anim-slot s1"><span class="anim-slot-label">Q1</span><div class="anim-coin coin-1">1</div></div>
                        <div class="anim-slot s2"><span class="anim-slot-label">Q2</span><div class="anim-coin coin-0">0</div></div>
                        <div class="anim-slot s3"><span class="anim-slot-label">Q3</span><div class="anim-coin coin-1">1</div></div>
                    </div>
                </div>
                <div class="animation-box">
                    <h3>Mode 2: Serial Shift (Left-to-Right)</h3>
                    <p><code>SH/LD</code> is <strong>SHIFT</strong>. On each clock pulse, coins shift one slot to the right (Q0 $\to$ Q1, etc.). The last coin (Q3) is pushed out.</p>
                    <div class="anim-stage" id="shift-anim">
                        <div class="anim-slot s0">
                            <span class="anim-slot-label">Q0</span>
                            <div class="anim-coin coin-0">0</div>
                            <div class="anim-coin coin-0 shift-in-0">0</div>
                        </div>
                        <div class="anim-slot s1"><span class="anim-slot-label">Q1</span><div class="anim-coin coin-1">1</div></div>
                        <div class="anim-slot s2"><span class="anim-slot-label">Q2</span><div class="anim-coin coin-0">0</div></div>
                        <div class="anim-slot s3"><span class="anim-slot-label">Q3</span><div class="anim-coin coin-1">1</div></div>
                        <div class="anim-out-box"><span class="anim-out-label">Serial Out</span></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>Interactive PISO Simulator</h2>
            <p>Now, let's control a register ourselves. The layout is <strong>Q0 to Q3 (left-to-right)</strong> to match the circuit diagram.</p>
            <div class="interactive-demo">
                
                <div class="controls">
                    <div class="control-group">
                        <label>Control Signals</label>
                        <label for="shift-load-toggle" style="font-size: 1em; font-weight: normal; margin-bottom: 10px;">Mode Select (SH/LD)</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="shift-load-toggle">
                            <span class="slider"></span>
                        </label>
                    </div>

                    <div class="control-group">
                        <label for="parallel-inputs">Parallel Data Inputs (P0-P3)</label>
                        <div class="parallel-inputs" id="parallel-inputs">
                            <div><span>P0</span><input type="checkbox" class="p-input" data-index="0"></div>
                            <div><span>P1</span><input type="checkbox" class="p-input" data-index="1"></div>
                            <div><span>P2</span><input type="checkbox" class="p-input" data-index="2"></div>
                            <div><span>P3</span><input type="checkbox" class="p-input" data-index="3"></div>
                        </div>
                    </div>
                    
                    <div class="button-group">
                        <button class="clock-button" id="clock-pulse">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/>
                                <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"/>
                            </svg>
                            Pulse Clock
                        </button>
                        <button class="reset-button" id="reset-button">
                            Reset
                        </button>
                    </div>
                    <div id="clock-count-display">Clock Pulses: 0</div>
                </div>

                <div class="visualizer">
                    <h3>Register State</h3>
                    <div class="register-bank">
                        <div class="flip-flop" id="ff0"><span class="ff-label">Q0</span><span class="ff-value">0</span></div>
                        <div class="flip-flop" id="ff1"><span class="ff-label">Q1</span><span class="ff-value">0</span></div>
                        <div class="flip-flop" id="ff2"><span class="ff-label">Q2</span><span class="ff-value">0</span></div>
                        <div class="flip-flop" id="ff3"><span class="ff-label">Q3</span><span class="ff-value">0</span></div>
                    </div>
                    <div class="serial-out">
                        <h3>Serial Output (from Q3)</h3>
                        <div class="flip-flop serial-out-box" id="s-out"><span class="ff-label">S_Out</span><span class="ff-value">0</span></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>How to Use the Simulator</h2>
            <h3>Part 1: Parallel Load</h3>
            <ol>
                <li>Make sure the toggle switch is on <strong>LOAD</strong> (Red).</li>
                <li>Set a 4-bit value. For example, check P1 and P3 for <code>1010</code> (reads <code>P3,P2,P1,P0</code>).</li>
                <li>Click <strong>"Pulse Clock"</strong> (Counter: 1).</li>
                <li>The "Register State" (Q0-Q3) will instantly update to <code>0101</code>. (Matches Pulse 1 in the table!)</li>
            </ol>

            <h3>Part 2: Serial Readout</h3>
            <ol>
                <li>After loading <code>0101</code>, flip the toggle switch to <strong>SHIFT</strong> (Green).</li>
                <li>Click <strong>"Pulse Clock"</strong> (Counter: 2). The <code>1</code> from Q3 moves to <strong>Serial Output</strong>. The register becomes <code>0010</code>. (Matches Pulse 2!)</li>
                <li>Click <strong>"Pulse Clock"</strong> (Counter: 3). The <code>0</code> from Q3 moves to Serial Out. The register becomes <code>0001</code>. (Matches Pulse 3!)</li>
                <li>Click <strong>"Reset"</strong>. Everything goes back to <code>0</code>.</li>
            </ol>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            const clockButton = document.getElementById('clock-pulse');
            const shiftLoadToggle = document.getElementById('shift-load-toggle');
            const pInputs = document.querySelectorAll('.p-input');
            
            // REVISED: ffElements array to match Q0-Q3 L-R layout
            const ffElements = [
                document.getElementById('ff0'),
                document.getElementById('ff1'),
                document.getElementById('ff2'),
                document.getElementById('ff3')
            ];
            
            const sOutElement = document.getElementById('s-out');
            const resetButton = document.getElementById('reset-button');
            const clockCountDisplay = document.getElementById('clock-count-display');

            // qState array now represents [Q0, Q1, Q2, Q3]
            let qState = [0, 0, 0, 0];
            let sOutState = 0;
            let clockCount = 0;

            clockButton.addEventListener('click', onClockPulse);
            resetButton.addEventListener('click', onReset);

            function onClockPulse() {
                const isShiftMode = shiftLoadToggle.checked;
                
                if (isShiftMode) {
                    // --- SHIFT Mode ---
                    sOutState = qState[3]; // Output Q3
                    
                    // Shift all bits L-R (Q0 -> Q1, Q1 -> Q2, etc.)
                    qState[3] = qState[2];
                    qState[2] = qState[1];
                    qState[1] = qState[0];
                    qState[0] = 0; // Shift a '0' into Q0
                } else {
                    // --- LOAD Mode ---
                    // Load P0->Q0, P1->Q1, etc.
                    pInputs.forEach(input => {
                        const index = parseInt(input.dataset.index, 10);
                        qState[index] = input.checked ? 1 : 0;
                    });
                    sOutState = qState[3]; // Output still reflects Q3
                }
                clockCount++;
                updateUI();
            }

            function onReset() {
                qState = [0, 0, 0, 0];
                sOutState = 0;
                clockCount = 0;
                pInputs.forEach(input => input.checked = false);
                updateUI();
            }

            function updateUI() {
                // Update Q0, Q1, Q2, Q3 visuals
                qState.forEach((val, index) => {
                    const el = ffElements[index];
                    const valEl = el.querySelector('.ff-value');
                    valEl.textContent = val;
                    el.classList.toggle('on', val === 1);
                });

                const sOutValEl = sOutElement.querySelector('.ff-value');
                sOutValEl.textContent = sOutState;
                sOutElement.classList.toggle('on', sOutState === 1);

                clockCountDisplay.textContent = `Clock Pulses: ${clockCount}`;
            }
            
            updateUI(); // Initialize UI
        });
    </script>

</body>
</html>